import{m as ce,r as n,j as e,P as de,A as pe,u as ue,G as me,f as c,C as w,B as d,t as N}from"./index-pzd77Z4S.js";import{P as R,a as I,b as F,R as he,A as xe,c as ge,d as fe,e as je,f as ve,g as Ne,h as Se,i as we,s as ye}from"./index-DA-93gds.js";import{R as De,D as O,a as E,b as T,c as z,P as Ce}from"./PlayerList-BtjsnH6o.js";import{u as ke}from"./index-B2GkG6WS.js";import{a as be,S as Ae}from"./SupportListWithFilter-CnwcPMF9.js";import{H as Pe}from"./Helmet-WtT2JHsX.js";import"./checkbox-BYrcEh8-.js";import"./label-ksYLtnI-.js";import"./useViewport-Bz46eOcy.js";/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Ie=ce("square-pen",Re);var Fe="Separator",U="horizontal",Oe=["horizontal","vertical"],L=n.forwardRef((a,p)=>{const{decorative:f,orientation:h=U,...S}=a,x=Ee(h)?h:U,g=f?{role:"none"}:{"aria-orientation":x==="vertical"?x:void 0,role:"separator"};return e.jsx(de.div,{"data-orientation":x,...g,...S,ref:p})});L.displayName=Fe;function Ee(a){return Oe.includes(a)}var Te=L;function ze({className:a,orientation:p="horizontal",decorative:f=!0,...h}){return e.jsx(Te,{"data-slot":"separator",decorative:f,orientation:p,className:pe("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",a),...h})}const Ge=()=>{const{t:a}=ue(),p=me(),[f,h]=n.useState(!1),[S,x]=n.useState(!1),[y,g]=n.useState(!1),[D,V]=n.useState(1),[u,v]=n.useState({type:"",deck:null,open:!1}),r=c.get("selected").value(),[m,C]=n.useState(r.supports),[i,k]=n.useState(r.player),[B,H]=n.useState(r.raceFilterCondition||{distanceType:[],grade:[],ground:[]}),[$,M]=n.useState(r.filterRace||{}),[_,b]=n.useState(c.get("myDecks").value()),j=ke();if(!j)return null;const q=j.get("races").value(),G=()=>x(!0),W=()=>x(!1),J=s=>{k(s),r.player=s,c.get("selected").assign(r).write(),W()},K=s=>{h(!0),g(!0),V(s)},Q=()=>{h(!1),g(!0)},A=()=>g(!1),X=s=>{const t={...m,[D]:s};C(t),r.supports[D]=s,c.get("selected").assign(r).write(),A()},Y=s=>{p(`/support-detail/${s.id}`),A()},P=(s=null)=>{let t={imgUrls:[],supportsId:[]};i!=null&&i.id&&(t.playerId=i.id,t.imgUrls.push(i.imgUrl)),[0,1,2,3,4,5].forEach(o=>{var l;(l=m[o])!=null&&l.id?(t.imgUrls.push(m[o].imgUrl),t.supportsId.push(m[o].id)):t.supportsId.push(null)}),s?(c.get("myDecks").find({id:s.id}).assign(t).write(),N.info("卡组已更新")):(t.id=ye.generate(),c.get("myDecks").push(t).write(),N.info("新卡组已保存")),b([...c.get("myDecks").value()])},Z=s=>{r.supports={0:{},1:{},2:{},3:{},4:{},5:{}},r.player={},s.playerId&&(r.player=j.get("players").find({id:s.playerId}).value()),k(r.player),s.supportsId.forEach((t,o)=>{t&&(r.supports[o]=j.get("supports").find({id:t}).value())}),C({...r.supports}),j.get("selected").assign(r).write(),N.info("卡组已加载")},ee=s=>{c.get("myDecks").remove({id:s.id}).write(),b([...c.get("myDecks").value()]),N.info("卡组已删除")},se=()=>{switch(u.type){case"save":P(u.deck);break;case"delete":ee(u.deck);break}v({...u,open:!1})},te=s=>{H(s);let t=Object.values(s).some(l=>l.length>0)?Object.entries(s).filter(([,l])=>l.length>0).reduce((l,[le,oe])=>l.filter(ne=>oe.includes(ne[le])),q):[],o={};for(let l of t)o[l.dateNum]?o[l.dateNum].push(l.id):o[l.dateNum]=[l.id];M(o),r.raceFilterCondition=s,r.filterRace=o,c.get("selected").assign(r).write()},ae=s=>p(`/support-detail/${s}`),re=s=>p(`/player-detail/${s}/1`),ie=()=>p("/buff");return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{children:e.jsx("title",{children:"育成 - 乌拉拉大胜利 - 赛马娘资料站"})}),e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full",children:[(i==null?void 0:i.imgUrl)&&e.jsx("img",{src:w+i.imgUrl,alt:i.imgUrl,className:"w-32 h-32 object-cover rounded-md cursor-pointer",onClick:()=>re(i.id)}),e.jsxs("div",{className:"flex flex-wrap gap-2 flex-1",children:[e.jsx(d,{variant:"outline",onClick:G,children:a("选择马娘")}),e.jsx(d,{variant:"outline",onClick:Q,children:a("支援卡查询")}),e.jsx(d,{variant:"outline",onClick:ie,children:a("BUFF")}),e.jsxs(R,{children:[e.jsx(I,{asChild:!0,children:e.jsx(d,{children:a("比赛")})}),e.jsx(F,{className:"w-80",children:e.jsx(he,{onChange:te,raceFilterCondition:B})})]}),e.jsxs(R,{children:[e.jsx(I,{asChild:!0,children:e.jsx(d,{children:a("我的卡组")})}),e.jsx(F,{className:"w-full max-w-2xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{variant:"outline",onClick:()=>P(),children:a("保存为新卡组")}),e.jsx("div",{className:"space-y-2",children:_.map(s=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:s.imgUrls.map(t=>e.jsx("img",{src:w+t,alt:t,className:"w-12 h-12 object-cover rounded"},t))}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>Z(s),children:a("读取")}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>v({type:"save",deck:s,open:!0}),children:a("覆盖")}),e.jsx(d,{variant:"destructive",size:"sm",onClick:()=>v({type:"delete",deck:s,open:!0}),children:a("删除")})]})]},s.id))})]})})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 w-full",children:[0,1,2,3,4,5].map(s=>{var t;return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>K(s),className:"w-full",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),a("选择支援卡")]}),((t=m[s])==null?void 0:t.id)&&e.jsx("img",{src:w+m[s].imgUrl,alt:m[s].name,className:"w-full h-auto rounded-md cursor-pointer",onClick:()=>ae(m[s].id)})]},s)})}),e.jsx(ze,{className:"my-4"}),e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:a("比赛")}),e.jsx(be,{className:"h-[400px] w-full border rounded p-4",children:e.jsx(De,{raceList:i==null?void 0:i.raceList,filterRace:$})})]})]}),e.jsx(O,{open:S,onOpenChange:x,children:e.jsxs(E,{className:"max-w-[90vw] h-[80vh]",children:[e.jsx(T,{children:e.jsx(z,{children:a("选择马娘")})}),e.jsx(Ce,{sortFlag:!0,onClick:J})]})}),e.jsx(O,{open:y,onOpenChange:g,children:e.jsxs(E,{className:"max-w-[90vw] h-[80vh]",children:[e.jsx(T,{children:e.jsx(z,{children:a("选择支援卡")})}),e.jsx(Ae,{formName:"nurSupMo",onClick:f?X:Y,sortFlag:!0})]})}),e.jsx(xe,{open:u.open,onOpenChange:s=>v({...u,open:s}),children:e.jsxs(ge,{children:[e.jsxs(fe,{children:[e.jsx(je,{children:"确认操作"}),e.jsxs(ve,{children:[u.type==="save"&&"确认覆盖此卡组？",u.type==="delete"&&"确认删除此卡组？"]})]}),e.jsxs(Ne,{children:[e.jsx(Se,{children:"取消"}),e.jsx(we,{onClick:se,children:"确认"})]})]})})]})};export{Ge as default};
